(this.webpackJsonpsimplemessengerapp=this.webpackJsonpsimplemessengerapp||[]).push([[0],{10:function(e,t,n){},17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var s=n(1),o=n.n(s),a=n(11),r=n.n(a),i=(n(17),n.p,n(10),n(5)),c=n(6),l=n(3),u=n(9),h=n(8),p=n(2),d=n(7),m=n.n(d),j=n(12),g=function(e){var t=1e3*(e.tokenObj.expires_in||3300);localStorage.setItem("authToken",e.tokenObj.id_token);var n=function(){var s=Object(j.a)(m.a.mark((function s(){var o;return m.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.reloadAuthResponse();case 2:o=s.sent,t=1e3*(o.expires_in||3300),localStorage.setItem("authToken",o.id_token),setTimeout(n,t);case 6:case"end":return s.stop()}}),s)})));return function(){return s.apply(this,arguments)}}();setTimeout(n,t)},f=n(0),b="1006529598178-qes2svv7q1t0a6pfgq01gq1te9fosee6.apps.googleusercontent.com",O=function(){return window.location.protocol+"//"+window.location.host+"/api"},v=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).state={otherUser:"",text:"",userName:"",users:[]},s.handleChange=s.handleChange.bind(Object(l.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(l.a)(s)),s}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{children:[Object(f.jsx)(p.GoogleLogin,{clientId:b,buttonText:"Login",onSuccess:function(t){console.log("Login Success: currentUser:",t.profileObj),alert("Logged in successfully welcome ".concat(t.profileObj.name," \ud83d\ude0d. \n See console for full profile object.")),console.log(t.profileObj.email),g(t),e.setState({userName:t.profileObj.email}),fetch("".concat(O(),"/user/"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t.profileObj.email,userdisplayname:t.profileObj.name})}),fetch("".concat(O(),"/user/otherUsers/").concat(e.state.userName),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+localStorage.authToken}}).then((function(e){return e.json()})).then((function(t){return e.setState({users:t,otherUser:t[0].username})}))},onFailure:function(e){console.log("Login failed: res:",e),alert("Failed to login. \ud83d\ude22 ")},cookiePolicy:"single_host_origin",style:{marginTop:"100px"},isSignedIn:!0}),Object(f.jsxs)("b",{children:["Logged in as : ",this.state.userName]}),Object(f.jsx)("br",{}),Object(f.jsx)("select",{id:"users",name:"users",onChange:function(t){e.setState({otherUser:t.target.value})},children:this.state.users.map((function(e){return Object(f.jsx)("option",{children:e.username})}))}),Object(f.jsx)(x,{userName:this.state.userName,otherUser:this.state.otherUser}),Object(f.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(f.jsx)("label",{htmlFor:"new-todo",children:"Enter your message here..."}),Object(f.jsx)("input",{id:"new-todo",onChange:this.handleChange,value:this.state.text}),Object(f.jsx)("button",{children:"Send"})]}),Object(f.jsx)(p.GoogleLogout,{clientId:b,buttonText:"Logout",onLogoutSuccess:function(){e.setState({otherUser:"",text:"",userName:"",users:[]}),console.log("Logout made successfully"),alert("Logout made successfully \u270c")}})]})}},{key:"handleChange",value:function(e){this.setState({text:e.target.value})}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),0!==this.state.text.length){var t={text:this.state.text,id:Date.now()};console.log(t.text),fetch("".concat(O(),"/message/"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+localStorage.authToken},body:JSON.stringify({sender:this.state.userName,receiver:this.state.otherUser,message:t.text})}).then((function(){console.log("MESSAGE SENT")}))}}}]),n}(o.a.Component),x=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).state={messages:[]},s}return Object(c.a)(n,[{key:"tick",value:function(){var e=this;fetch("".concat(O(),"/message/?sender=").concat(this.props.userName,"&receiver=").concat(this.props.otherUser),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+localStorage.authToken}}).then((function(e){return e.json()})).then((function(t){e.setState({messages:t})}))}},{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval((function(){return e.tick()}),1e3),console.log("Inside did Mount")}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=this;return Object(f.jsx)("div",{className:"Messages-box",children:this.state.messages.map((function(t){return function(t){var n=new Date(t.time);return t.sender===e.props.userName?Object(f.jsxs)("div",{className:"Message-element",children:[t.message," ",Object(f.jsx)("span",{className:"Message-time",children:n.toLocaleString()})]}):Object(f.jsxs)("div",{className:"Received-Message-element",children:[t.message," ",Object(f.jsx)("span",{className:"Message-time",children:n.toLocaleString()})]})}(t)}))})}}]),n}(o.a.Component),S=v;var y=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(S,{})})},k=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,s=t.getFID,o=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),s(e),o(e),a(e),r(e)}))};r.a.render(Object(f.jsx)(o.a.StrictMode,{children:Object(f.jsx)(y,{})}),document.getElementById("root")),k()}},[[20,1,2]]]);
//# sourceMappingURL=main.0aaecd03.chunk.js.map